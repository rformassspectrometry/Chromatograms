<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Creating new `ChromBackend` classes for Chromatograms • Chromatograms</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Creating new `ChromBackend` classes for Chromatograms">
<meta property="og:description" content="Chromatograms">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Chromatograms</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/creating-backend-classes.html">Creating new `ChromBackend` classes for Chromatograms</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/RforMassSpectrometry/Chromatograms/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Creating new <code>ChromBackend</code> classes
for Chromatograms</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/Chromatograms/blob/HEAD/vignettes/creating-backend-classes.Rmd" class="external-link"><code>vignettes/creating-backend-classes.Rmd</code></a></small>
      <div class="hidden name"><code>creating-backend-classes.Rmd</code></div>

    </div>

    
    
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  document.querySelector("h1").className = "title";
});
</script><script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  var links = document.links;  
  for (var i = 0, linksLength = links.length; i < linksLength; i++)
    if (links[i].hostname != window.location.hostname)
      links[i].target = '_blank';
});
</script><p><strong>Package</strong>: <em><a href="https://bioconductor.org/packages/3.19/Chromatograms" class="external-link">Chromatograms</a></em><br><strong>Authors</strong>: Laurent Gatto [aut] (<a href="https://orcid.org/0000-0002-1520-2268" class="external-link uri">https://orcid.org/0000-0002-1520-2268</a>), Johannes Rainer
[aut, cre] (<a href="https://orcid.org/0000-0002-6977-7147" class="external-link uri">https://orcid.org/0000-0002-6977-7147</a>), Philippine
Louail [aut] (<a href="https://orcid.org/0009-0007-5429-6846" class="external-link uri">https://orcid.org/0009-0007-5429-6846</a>)<br><strong>Compiled</strong>: Wed Mar 27 08:08:52 2024</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Similar to the <em><a href="https://bioconductor.org/packages/3.19/Spectra" class="external-link">Spectra</a></em>
package, the <em><a href="https://bioconductor.org/packages/3.19/Chromatograms" class="external-link">Chromatograms</a></em>
also separates the user-faced functionality to process and analyze
chromatographic mass spectrometry (MS) data from the code for storage
and <em>representation</em> of the data. The latter functionality is
provided by implementations of the <code>ChromBackend</code> class,
further on called <em>backends</em>. This vignette describes the
<code>ChromBackend</code> class and illustrates on a simple example how
a backend extending this class could be implemented.</p>
<p>Contributions to this vignette (content or correction of typos) or
requests for additional details and information are highly welcome,
ideally <em>via</em> pull requests or <em>issues</em> on the package’s
<a href="https://github.com/RforMassSpectrometry/Chromatograms" class="external-link">github
repository</a>.</p>
</div>
<div class="section level2">
<h2 id="what-is-a-chrombackend">What is a <code>ChromBackend</code>?<a class="anchor" aria-label="anchor" href="#what-is-a-chrombackend"></a>
</h2>
<p>The purpose of a backend class extending the virtual
<code>ChromBackend</code> is to provide the chromatographic MS data to
the <code>Chromatograms</code> object, which is used by the user to
interact with - and analyze the data. The <code>ChromBackend</code>
defines the API that new backends need to provide so that they can be
used with <code>Chromatograms</code>. This API defines a set of methods
to access the data. For many functions default implementations exist and
a dedicated implementation for a new backend is only needed if necessary
(e.g. if the data is stored in a way that a different access to it would
be better). In addition, a core set of variables (data fields), the so
called <em>core</em> chromatogram variables, is defined to describe the
chromatographic data. Each backend needs to provide these, but can in
also define additional data fields. Before implementing a new backend it
is highly suggested to carefully read the following <em>Conventions and
definitions</em> section.</p>
<div class="section level3">
<h3 id="conventions-and-definitions">Conventions and definitions<a class="anchor" aria-label="anchor" href="#conventions-and-definitions"></a>
</h3>
<p>General conventions for chromatographic MS data of a
<code>Chromatograms</code> are:</p>
<ul>
<li>One <code>Chromatograms</code> object is designed to contain
multiple chromatographic data (not data from a single
chromatogram).</li>
<li>retention time values within each chromatogram are expected to be
sorted increasingly.</li>
<li>Missing values (<code>NA</code>) for retention time values are not
supported.</li>
<li>Properties (data fields) of a spectrum are called <em>chromatogram
variables</em>. While backends can define their own properties, a
minimum required set of chromatogram variables <strong>must</strong> be
provided by each backend (even if their values are empty). These
<em>core chromatogram variables</em> are listed (along with their
expected data type) by the <code><a href="../reference/ChromBackend.html">coreChromVariables()</a></code>
function.</li>
<li>
<code>dataStorage</code> and <code>dataOrigin</code> are two special
variables that define for each chromatogram where the data is
(currently) stored and from where the data derived, respectively. Both
are expected to be of type<code>character</code>. Missing values for
<code>dataStorage</code> are not allowed.</li>
<li>
<code>ChromBackend</code> implementations can also represent purely
<em>read-only</em> data resources. In this case only data accessor
methods need to be implemented but not data replacement methods
(i.e. <code>&lt;-</code> methods that would allow to add or set
variables. Read-only backends should implement the
<code><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">isReadOnly()</a></code> method, that should then return
<code>TRUE</code>. Note that backends for purely read-only resources
could also implement a <em>caching</em> mechanism to (temporarily) store
changes to the data locally within the object (and hence in memory). See
information on the <code>MsBackendCached</code> in the <em><a href="https://bioconductor.org/packages/3.19/Spectra" class="external-link">Spectra</a></em>
package for more details.</li>
</ul>
</div>
<div class="section level3">
<h3 id="notes-on-parallel-and-chunk-wise-processing">Notes on parallel and chunk-wise processing<a class="anchor" aria-label="anchor" href="#notes-on-parallel-and-chunk-wise-processing"></a>
</h3>
<p>For parallel processing, <code>Chromatograms</code> splits the
backend based on a defined <code>factor</code> and processes each in
parallel (or <em>in serial</em> if a <code>SerialParam</code> is used).
The splitting <code>factor</code> can be defined for
<code>Chromatograms</code> by setting the parameter
<code>processingChunkSize</code>. Alternatively, through the
<code><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">backendParallelFactor()</a></code> method the backend can also
<em>suggest</em> a <code>factor</code> that should/could be used for
splitting and parallel processing. The default implementation for
<code><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">backendParallelFactor()</a></code> is to return an empty
<code>factor</code> (<code><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor()</a></code>) hence not suggesting any
preferred splitting.</p>
<p>Besides parallel processing, for on-disk backends (i.e., backends
that don’t keep all of the data in memory), this chunk-wise processing
can also reduce the memory demand for operations, because only the peak
data of the current chunk needs to be realized in memory.</p>
</div>
</div>
<div class="section level2">
<h2 id="api">API<a class="anchor" aria-label="anchor" href="#api"></a>
</h2>
<p>The <code>ChromBackend</code> class defines core methods that have to
be implemented by a MS <em>backend</em> as well as <em>optional</em>
methods for which a default implementation is already available. These
functions are described in sections <em>Required methods</em> and
<em>Optional methods</em>, respectively.</p>
<p>To create a new backend a class extending the virtual
<code>ChromBackend</code> needs to be implemented. In the example below
we create thus a simple class with a <code>data.frame</code> for general
properties (<em>chromatogram variables</em>) and two slots for the
retention time and intensity values, representing the actual
chromatographic MS data. We store these values as <code>list</code>,
each list element representing values for one chromatogram, since the
number of values (<em>peaks</em>) can be different between
chromatograms. We also define a simple constructor function that returns
an empty instance of our new class.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/Chromatograms" class="external-link">Chromatograms</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' Definition of the backend class extending ChromBackend</span></span>
<span><span class="kw">setClass</span><span class="op">(</span><span class="st">"ChromBackendTest"</span>,</span>
<span>         contains <span class="op">=</span> <span class="st">"ChromBackend"</span>,</span>
<span>         slots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>             chromVars <span class="op">=</span> <span class="st">"data.frame"</span>,</span>
<span>             rtime <span class="op">=</span> <span class="st">"list"</span>,</span>
<span>             intensity <span class="op">=</span> <span class="st">"list"</span></span>
<span>         <span class="op">)</span>,</span>
<span>         prototype <span class="op">=</span> <span class="fu">prototype</span><span class="op">(</span></span>
<span>             spectraVars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>             rtime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>             intensity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>         <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' Simple constructor function</span></span>
<span><span class="va">ChromBackendTest</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">new</span><span class="op">(</span><span class="st">"ChromBackendTest"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The 3 slots <code>@chromVars</code>, <code>@rtime</code> and
<code>@intensity</code> will be used to store our MS data: each row in
<code>chromVars</code> will contain data for one chromatogram with the
columns being the different <em>chromatogram variables</em>
(i.e. additional properties of a chromatogram such as its m/z value or
MS level) and each element in <code>@rtime</code> and
<code>@intensity</code> a <code>numeric</code> vector with the retention
times and intensity values representing thus the <em>peaks</em> data of
the respective chromatogram. This is only one of the possibly many ways
chromatographic data might be represented.</p>
<p>We should ideally also add some basic validity function that ensures
the data to be correct (valid). The function below simply checks that
the number of rows of the <code>@chromVars</code> slot matches the
length of the <code>@rtime</code> and <code>@intensity</code> slots.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Basic validation function</span></span>
<span><span class="fu">setValidity</span><span class="op">(</span><span class="st">"ChromBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">object</span><span class="op">@</span><span class="va">rtime</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">object</span><span class="op">@</span><span class="va">intensity</span><span class="op">)</span> <span class="op">||</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">object</span><span class="op">@</span><span class="va">rtime</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">object</span><span class="op">@</span><span class="va">chromVars</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">"length of 'rtime' and 'intensity' has to match the number of "</span>,</span>
<span>               <span class="st">"rows of 'chromVars'"</span><span class="op">)</span></span>
<span>    <span class="cn">NULL</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Class "ChromBackendTest" [in ".GlobalEnv"]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Slots:</span></span>
<span><span class="co">##                                                   </span></span>
<span><span class="co">## Name:   chromVars      rtime  intensity    version</span></span>
<span><span class="co">## Class: data.frame       list       list  character</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Extends: "ChromBackend"</span></span></code></pre>
<p>We can now create an instance of our new class with the
<code>ChromBackendTest()</code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Create an empty instance of ChromBackendTest</span></span>
<span><span class="va">be</span> <span class="op">&lt;-</span> <span class="fu">ChromBackendTest</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">be</span></span></code></pre></div>
<pre><code><span><span class="co">## An object of class "ChromBackendTest"</span></span>
<span><span class="co">## Slot "chromVars":</span></span>
<span><span class="co">## data frame with 0 columns and 0 rows</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Slot "rtime":</span></span>
<span><span class="co">## list()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Slot "intensity":</span></span>
<span><span class="co">## list()</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Slot "version":</span></span>
<span><span class="co">## [1] "0.1"</span></span></code></pre>
<p>A <code>show()</code> method would allow for a more convenient way
how general information of our object is displayed. Below we add an
implementation of the <code>show()</code> method.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' implementation of show for ChromBackendTest</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"show"</span>, <span class="st">"ChromBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">cd</span> <span class="op">&lt;-</span> <span class="va">object</span><span class="op">@</span><span class="va">chromVars</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>, <span class="st">"with"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cd</span><span class="op">)</span>, <span class="st">"chromatograms\n"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">be</span></span></code></pre></div>
<pre><code><span><span class="co">## ChromBackendTest with 0 chromatograms</span></span></code></pre>
<div class="section level3">
<h3 id="required-methods">Required methods<a class="anchor" aria-label="anchor" href="#required-methods"></a>
</h3>
<p>Methods listed in this section <strong>must</strong> be implemented
for a new class extending <code>ChromBackend</code>. Methods should
ideally also be implemented in the order they are listed here. Also, it
is strongly advised to write dedicated unit tests for each newly
implemented method or function already <strong>during</strong> the
development.</p>
<div class="section level4">
<h4 id="datastorage">
<code>dataStorage()</code><a class="anchor" aria-label="anchor" href="#datastorage"></a>
</h4>
<p>The <code>dataStorage</code> chromatogram variable provides
information how or where the data is stored. The
<code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataStorage()</a></code> method should therefore return a
<code>character</code> vector of length equal to the number of
chromatograms that are represented by the object. The values for
<code>dataStorage</code> can be any character value, except
<code>NA</code>. For our example backend we define a simple
<code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataStorage()</a></code> method that simply returns the column
<code>"dataStorage"</code> from the <code>@chromVars</code> (as a
<code>character</code>).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' dataStorage method to provide information *where* data is stored</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"dataStorage"</span>, <span class="st">"ChromBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">object</span><span class="op">@</span><span class="va">chromVars</span><span class="op">$</span><span class="va">dataStorage</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Calling <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataStorage()</a></code> on our example backend will thus
return an empty <code>character</code> (since the object created above
does not contain any data).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataStorage</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## character(0)</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="length">
<code>length()</code><a class="anchor" aria-label="anchor" href="#length"></a>
</h4>
<p><code><a href="https://rdrr.io/r/base/length.html" class="external-link">length()</a></code> is expected to return an <code>integer</code>
of length 1 with the total number of chromatograms that are represented
by the backend. For our example backend we simply return the number of
rows of the <code>data.frame</code> stored in the
<code>@chromVars</code> slot.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' length to provide information on the number of chromatograms</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"length"</span>, <span class="st">"ChromBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">@</span><span class="va">chromVars</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="backendinitialize">
<code>backendInitialize()</code><a class="anchor" aria-label="anchor" href="#backendinitialize"></a>
</h4>
<p>The <code><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">backendInitialize()</a></code> method is expected to be called
after creating an instance of the backend class and should prepare
(initialize) the backend with data. This method can take any parameters
needed by the backend to get loaded/initialized with data (which can be
file names from which to load the data, a database connection or
object(s) containing the data). During <code><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">backendInitialize()</a></code>
it is also suggested to set the special spectra variables
<code>dataStorage</code> and <code>dataOrigin</code> are set.</p>
<p>Below we define a <code><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">backendInitialize()</a></code> method that takes
as arguments a <code>data.frame</code> with spectra variables and two
<code>list</code>s with the retention time and intensity values for each
spectrum.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' backendInitialize method to fill the backend with data.</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span></span>
<span>    <span class="st">"backendInitialize"</span>, <span class="st">"ChromBackendTest"</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">chromVars</span>, <span class="va">rtime</span>, <span class="va">intensity</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">is.data.frame</a></span><span class="op">(</span><span class="va">chromVars</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"'chromVars' needs to be a 'data.frame' with the general"</span>,</span>
<span>                 <span class="st">"chromatogram variables"</span><span class="op">)</span></span>
<span>        <span class="co">## Defining dataStorage and dataOrigin, if not available</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">chromVars</span><span class="op">$</span><span class="va">dataStorage</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="va">chromVars</span><span class="op">$</span><span class="va">dataStorage</span> <span class="op">&lt;-</span> <span class="st">"&lt;memory&gt;"</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">chromVars</span><span class="op">$</span><span class="va">dataOrigin</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="va">chromVars</span><span class="op">$</span><span class="va">dataOrigin</span> <span class="op">&lt;-</span> <span class="st">"&lt;user provided&gt;"</span></span>
<span>        <span class="va">object</span><span class="op">@</span><span class="va">chromVars</span> <span class="op">&lt;-</span> <span class="va">chromVars</span></span>
<span>        <span class="va">object</span><span class="op">@</span><span class="va">rtime</span> <span class="op">&lt;-</span> <span class="va">rtime</span></span>
<span>        <span class="va">object</span><span class="op">@</span><span class="va">intensity</span> <span class="op">&lt;-</span> <span class="va">intensity</span></span>
<span>        <span class="fu">validObject</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span>        <span class="va">object</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>In addition to adding the data to object, the function also defined
the <code>dataStorage</code> and <code>dataOrigin</code> spectra
variables. The purpose of these two variables is to provide some
information on where the data is currently stored (<em>in memory</em> as
in our example) and from where the data is originating.</p>
<p>We can now create an instance of our backend class and fill it with
data. We thus first define our MS data and pass this to the
<code><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">backendInitialize()</a></code> method.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' A data.frame with chromatogram variables.</span></span>
<span><span class="va">cvars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>msLevel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">1L</span>, <span class="fl">1L</span><span class="op">)</span>,</span>
<span>                    mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">112.2</span>, <span class="fl">123.3</span>, <span class="fl">134.4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#' retention time values for each chromatogram.</span></span>
<span><span class="va">rts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12.4</span>, <span class="fl">12.8</span>, <span class="fl">13.2</span>, <span class="fl">14.6</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">45.1</span>, <span class="fl">46.2</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">64.4</span>, <span class="fl">64.8</span>, <span class="fl">65.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#' intensity values for each chromatogram.</span></span>
<span><span class="va">ints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">123.3</span>, <span class="fl">153.6</span>, <span class="fl">2354.3</span>, <span class="fl">243.4</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">80.1</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12.3</span>, <span class="fl">135.2</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' Create and initialize the backend</span></span>
<span><span class="va">be</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">backendInitialize</a></span><span class="op">(</span><span class="fu">ChromBackendTest</span><span class="op">(</span><span class="op">)</span>,</span>
<span>                        chromVars <span class="op">=</span> <span class="va">cvars</span>, rtime <span class="op">=</span> <span class="va">rts</span>, intensity <span class="op">=</span> <span class="va">ints</span><span class="op">)</span></span>
<span><span class="va">be</span></span></code></pre></div>
<pre><code><span><span class="co">## ChromBackendTest with 3 chromatograms</span></span></code></pre>
<p>While this method works and is compliant with the
<code>MsBackend</code> API (because there is no requirement on the input
parameters for the <code><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">backendInitialize()</a></code> method), it would be
good practice for backends to support an additional parameter
<code>data</code> that would allow passing the <em>complete</em> MS data
(including retention time and intensity values) to the function as a
<code>DataFrame</code>. This would simplify the implementation of some
replacement methods and would in addition also allow to change the
backend of a <code>Chromatograms</code> using the
<code><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">setBackend()</a></code> function to our new backend. Also, it is
highly suggested to check the validity of the input data within the
initialize method. The advantage of performing these validity checks in
<code><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">backendInitialize()</a></code> over adding them with
<code>setValidity()</code> is that eventually computationally expensive
operations/checks would only performed once instead of each time values
within the object are changed (e.g. by subsetting or similar), which
would be the case with validation functionality registered with
<code>setValidity()</code>.</p>
<p>We thus re-implement the <code><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">backendInitialize()</a></code> method
supporting also the <code>data</code> parameter mentioned above and add
additional validity checks. These validity checks verify that only
numeric values are provided with <code>rtime</code> and
<code>intensity</code>, that the number of retention time and intensity
values matches for each chromatogram. We also use the
<code><a href="../reference/validChromData.html">validChromData()</a></code> function that checks that provided core
chromatogram variables have the correct data type.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Reimplementation of backendInitialize with a `data` parameter and</span></span>
<span><span class="co">#' additional input validation</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span></span>
<span>    <span class="st">"backendInitialize"</span>, <span class="st">"ChromBackendTest"</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">chromVars</span>, <span class="va">rtime</span>, <span class="va">intensity</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co">## Extract relevant information from a parameter `data` if provided</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html" class="external-link">missing</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">chromVars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span></span>
<span>                <span class="va">data</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rtime"</span>, <span class="st">"intensity"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="st">"rtime"</span><span class="op">)</span><span class="op">)</span></span>
<span>                <span class="va">rtime</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">rtime</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="st">"intensity"</span><span class="op">)</span><span class="op">)</span></span>
<span>                <span class="va">intensity</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">intensity</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="co">## Check that provided variables have the correct data type</span></span>
<span>        <span class="fu"><a href="../reference/validChromData.html">validChromData</a></span><span class="op">(</span><span class="va">chromVars</span><span class="op">)</span></span>
<span>        <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">chromVars</span><span class="op">)</span></span>
<span>        <span class="co">## Validate rtime and intensity</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html" class="external-link">missing</a></span><span class="op">(</span><span class="va">rtime</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="va">rtime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="va">n</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html" class="external-link">missing</a></span><span class="op">(</span><span class="va">intensity</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="va">intensity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="va">n</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rtime</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">intensity</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rtime</span><span class="op">)</span> <span class="op">!=</span> <span class="va">n</span><span class="op">)</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"lengths of 'rtime' and 'intensity' need to match the "</span>,</span>
<span>                 <span class="st">"number of chromatograms (i.e., nrow of 'chromVars'"</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">rtime</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">intensity</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"the number of data values in 'rtime' and 'intensity' have "</span>,</span>
<span>                 <span class="st">"to match"</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">rtime</span>, <span class="va">is.numeric</span>, <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"'rtime' has to be a list of numeric values"</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">intensity</span>, <span class="va">is.numeric</span>, <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"'intensity' has to be a list of numeric values"</span><span class="op">)</span></span>
<span>        <span class="co">## If rtime or itensity is of type NumericList convert to list</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">rtime</span>, <span class="st">"NumericList"</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="va">rtime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">rtime</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">intensity</span>, <span class="st">"NumericList"</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="va">intensity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">intensity</span><span class="op">)</span></span>
<span>        <span class="co">## Setting dataStorage and dataOrigin</span></span>
<span>        <span class="va">chromVars</span><span class="op">$</span><span class="va">dataStorage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"&lt;memory&gt;"</span>, <span class="va">n</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">chromVars</span><span class="op">$</span><span class="va">dataOrigin</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="va">chromVars</span><span class="op">$</span><span class="va">dataOrigin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"&lt;user provided&gt;"</span>, <span class="va">n</span><span class="op">)</span></span>
<span>        <span class="co">## Fill object with data</span></span>
<span>        <span class="va">object</span><span class="op">@</span><span class="va">chromVars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">chromVars</span><span class="op">)</span></span>
<span>        <span class="va">object</span><span class="op">@</span><span class="va">rtime</span> <span class="op">&lt;-</span> <span class="va">rtime</span></span>
<span>        <span class="va">object</span><span class="op">@</span><span class="va">intensity</span> <span class="op">&lt;-</span> <span class="va">intensity</span></span>
<span>        <span class="fu">validObject</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span>        <span class="va">object</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>This extended <code><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">backendInitialize()</a></code> implementation would
now also assure data validity and integrity. Below we use this function
again to create our backend instance.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Create and initialize the backend</span></span>
<span><span class="va">be</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">backendInitialize</a></span><span class="op">(</span><span class="fu">ChromBackendTest</span><span class="op">(</span><span class="op">)</span>,</span>
<span>                        chromVars <span class="op">=</span> <span class="va">cvars</span>, rtime <span class="op">=</span> <span class="va">rts</span>,</span>
<span>                        intensity <span class="op">=</span> <span class="va">ints</span><span class="op">)</span></span>
<span><span class="va">be</span></span></code></pre></div>
<pre><code><span><span class="co">## ChromBackendTest with 3 chromatograms</span></span></code></pre>
<p>The <code><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">backendInitialize()</a></code> method that we implemented for
our backend class expects the user to provide the full MS data. It would
alternatively also be possible to implement a method that takes data
file names as input from which the function can then import the data.
The purpose of the <code><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">backendInitialize()</a></code> method is to
<em>initialize</em> and prepare the data in a way that it can be
accessed by a <code>Chromatograms</code> object. Whether the data is
actually loaded into memory or simply referenced and loaded upon request
does not matter as long as the backend is able to provide the data
though its accessor methods when requested by the
<code>Chromatograms</code> object.</p>
</div>
<div class="section level4">
<h4 id="chromvariables">
<code>chromVariables()</code><a class="anchor" aria-label="anchor" href="#chromvariables"></a>
</h4>
<p>The <code><a href="../reference/ChromBackend.html">chromVariables()</a></code> method should return a
<code>character</code> vector with the names of all available
chromatogram variables of the backend. While a backend class should
support defining and providing their own variables, each
<code>ChromBackend</code> class <strong>must</strong> provide also the
<em>core chromatogram variables</em> (in the correct data type). These
can be listed by the <code><a href="../reference/ChromBackend.html">coreChromVariables()</a></code> function:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' List core chromatogram variables along with data types.</span></span>
<span><span class="fu"><a href="../reference/ChromBackend.html">coreChromVariables</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      chromIndex collisionEnergy      dataOrigin     dataStorage       intensity </span></span>
<span><span class="co">##       "integer"       "numeric"     "character"     "character"   "NumericList" </span></span>
<span><span class="co">##         msLevel              mz           mzMin           mzMax     precursorMz </span></span>
<span><span class="co">##       "integer"       "numeric"       "numeric"       "numeric"       "numeric" </span></span>
<span><span class="co">##  precursorMzMin  precursorMzMax       productMz    productMzMin    productMzMax </span></span>
<span><span class="co">##       "numeric"       "numeric"       "numeric"       "numeric"       "numeric" </span></span>
<span><span class="co">##           rtime </span></span>
<span><span class="co">##   "NumericList"</span></span></code></pre>
<p>A typical <code><a href="../reference/ChromBackend.html">chromVariables()</a></code> method for a
<code>ChromBackend</code> class will thus be implemented similarly to
the one for our <code>ChromBackendTest</code> test backend: it will
return the union of the core chromatogram variables and the names for
all available spectra variables within the backend object.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Accessor for available chromatogram variables</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"chromVariables"</span>, <span class="st">"ChromBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">union</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="../reference/ChromBackend.html">coreChromVariables</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">object</span><span class="op">@</span><span class="va">chromVars</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ChromBackend.html">chromVariables</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "chromIndex"      "collisionEnergy" "dataOrigin"      "dataStorage"    </span></span>
<span><span class="co">##  [5] "intensity"       "msLevel"         "mz"              "mzMin"          </span></span>
<span><span class="co">##  [9] "mzMax"           "precursorMz"     "precursorMzMin"  "precursorMzMax" </span></span>
<span><span class="co">## [13] "productMz"       "productMzMin"    "productMzMax"    "rtime"</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="chromdata">
<code>chromData()</code><a class="anchor" aria-label="anchor" href="#chromdata"></a>
</h4>
<p>The <code>chromData</code> method should return the
<strong>full</strong> chromatogram data within a backend as a
<code>DataFrame</code> object (defined in the <em><a href="https://bioconductor.org/packages/3.19/S4Vectors" class="external-link">S4Vectors</a></em>
package). A parameter <code>columns</code> should allow to define the
names of the variables that should be returned. Each row in this data
frame should represent one chromatogram, each column a chromatogram
variable. Columns <code>"rtime"</code> and <code>"intensity"</code> (if
requested) have to contain each a <code>NumericList</code> with the
retention time and intensity values of the chromatograms. The
<code>DataFrame</code> <strong>must</strong> provide values (even if
they are <code>NA</code>) for <strong>all</strong> requested spectra
variables of the backend (<strong>including</strong> the core
chromatogram variables). The <code><a href="../reference/fillCoreChromVariables.html">fillCoreChromVariables()</a></code>
function from the <em>Chromatograms</em> package allows to
<em>complete</em> (fill) a provided <code>data.frame</code> with
eventually missing core chromatogram variables (columns):</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Get the data.frame with the available chrom variables</span></span>
<span><span class="va">be</span><span class="op">@</span><span class="va">chromVars</span></span></code></pre></div>
<pre><code><span><span class="co">##   msLevel    mz dataStorage      dataOrigin</span></span>
<span><span class="co">## 1       1 112.2    &lt;memory&gt; &lt;user provided&gt;</span></span>
<span><span class="co">## 2       1 123.3    &lt;memory&gt; &lt;user provided&gt;</span></span>
<span><span class="co">## 3       1 134.4    &lt;memory&gt; &lt;user provided&gt;</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Complete this data.frame with missing core variables</span></span>
<span><span class="fu"><a href="../reference/fillCoreChromVariables.html">fillCoreChromVariables</a></span><span class="op">(</span><span class="va">be</span><span class="op">@</span><span class="va">chromVars</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   msLevel    mz dataStorage      dataOrigin chromIndex collisionEnergy</span></span>
<span><span class="co">## 1       1 112.2    &lt;memory&gt; &lt;user provided&gt;         NA              NA</span></span>
<span><span class="co">## 2       1 123.3    &lt;memory&gt; &lt;user provided&gt;         NA              NA</span></span>
<span><span class="co">## 3       1 134.4    &lt;memory&gt; &lt;user provided&gt;         NA              NA</span></span>
<span><span class="co">##   dataOrigin dataStorage msLevel mz mzMin mzMax precursorMz precursorMzMin</span></span>
<span><span class="co">## 1       &lt;NA&gt;        &lt;NA&gt;      NA NA    NA    NA          NA             NA</span></span>
<span><span class="co">## 2       &lt;NA&gt;        &lt;NA&gt;      NA NA    NA    NA          NA             NA</span></span>
<span><span class="co">## 3       &lt;NA&gt;        &lt;NA&gt;      NA NA    NA    NA          NA             NA</span></span>
<span><span class="co">##   precursorMzMax productMz productMzMin productMzMax</span></span>
<span><span class="co">## 1             NA        NA           NA           NA</span></span>
<span><span class="co">## 2             NA        NA           NA           NA</span></span>
<span><span class="co">## 3             NA        NA           NA           NA</span></span></code></pre>
<p>We can thus use this function to add eventually missing core
chromatogram variables in the <code>chromData</code> implementation for
our backend:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' function to extract the full chrom data; we would need to import the</span></span>
<span><span class="co">#' `DataFrame()` function from the S4Vectors package and the `NumericList`</span></span>
<span><span class="co">#' from the IRanges package.</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span></span>
<span>    <span class="st">"chromData"</span>, <span class="st">"ChromBackendTest"</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">columns</span> <span class="op">=</span> <span class="fu"><a href="../reference/ChromBackend.html">chromVariables</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">columns</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="../reference/ChromBackend.html">chromVariables</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Some of the requested variables are not available"</span><span class="op">)</span></span>
<span>        <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">S4Vectors</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/DataFrame-class.html" class="external-link">DataFrame</a></span><span class="op">(</span><span class="va">object</span><span class="op">@</span><span class="va">chromVars</span><span class="op">)</span></span>
<span>        <span class="co">## Add rtime and intensity values to the result; would need to</span></span>
<span>        <span class="co">## import the `NumericList()` function from the IRanges package</span></span>
<span>        <span class="va">res</span><span class="op">$</span><span class="va">rtime</span> <span class="op">&lt;-</span> <span class="fu">IRanges</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/AtomicList-class.html" class="external-link">NumericList</a></span><span class="op">(</span><span class="va">object</span><span class="op">@</span><span class="va">rtime</span>, compress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>        <span class="va">res</span><span class="op">$</span><span class="va">intensity</span> <span class="op">&lt;-</span> <span class="fu">IRanges</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/AtomicList-class.html" class="external-link">NumericList</a></span><span class="op">(</span></span>
<span>                                      <span class="va">object</span><span class="op">@</span><span class="va">intensity</span>, compress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>        <span class="co">## Fill with eventually missing core variables</span></span>
<span>        <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fillCoreChromVariables.html">fillCoreChromVariables</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span>        <span class="va">res</span><span class="op">[</span>, <span class="va">columns</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>We can now use <code><a href="../reference/ChromBackend.html">chromData()</a></code> to either extract the full
chromatogram data from the backend, or only the data for selected
variables.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Extract the full data</span></span>
<span><span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## DataFrame with 3 rows and 16 columns</span></span>
<span><span class="co">##   chromIndex collisionEnergy      dataOrigin dataStorage</span></span>
<span><span class="co">##    &lt;integer&gt;       &lt;numeric&gt;     &lt;character&gt; &lt;character&gt;</span></span>
<span><span class="co">## 1         NA              NA &lt;user provided&gt;    &lt;memory&gt;</span></span>
<span><span class="co">## 2         NA              NA &lt;user provided&gt;    &lt;memory&gt;</span></span>
<span><span class="co">## 3         NA              NA &lt;user provided&gt;    &lt;memory&gt;</span></span>
<span><span class="co">##                  intensity   msLevel        mz     mzMin     mzMax precursorMz</span></span>
<span><span class="co">##              &lt;NumericList&gt; &lt;integer&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;</span></span>
<span><span class="co">## 1  123.3, 153.6,2354.3,...         1     112.2        NA        NA          NA</span></span>
<span><span class="co">## 2              100.0, 80.1         1     123.3        NA        NA          NA</span></span>
<span><span class="co">## 3         12.3,135.2,100.0         1     134.4        NA        NA          NA</span></span>
<span><span class="co">##   precursorMzMin precursorMzMax productMz productMzMin productMzMax</span></span>
<span><span class="co">##        &lt;numeric&gt;      &lt;numeric&gt; &lt;numeric&gt;    &lt;numeric&gt;    &lt;numeric&gt;</span></span>
<span><span class="co">## 1             NA             NA        NA           NA           NA</span></span>
<span><span class="co">## 2             NA             NA        NA           NA           NA</span></span>
<span><span class="co">## 3             NA             NA        NA           NA           NA</span></span>
<span><span class="co">##                rtime</span></span>
<span><span class="co">##        &lt;NumericList&gt;</span></span>
<span><span class="co">## 1 12.4,12.8,13.2,...</span></span>
<span><span class="co">## 2          45.1,46.2</span></span>
<span><span class="co">## 3     64.4,64.8,65.2</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Selected variables</span></span>
<span><span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">be</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rtime"</span>, <span class="st">"mz"</span>, <span class="st">"msLevel"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## DataFrame with 3 rows and 3 columns</span></span>
<span><span class="co">##                rtime        mz   msLevel</span></span>
<span><span class="co">##        &lt;NumericList&gt; &lt;numeric&gt; &lt;integer&gt;</span></span>
<span><span class="co">## 1 12.4,12.8,13.2,...     112.2         1</span></span>
<span><span class="co">## 2          45.1,46.2     123.3         1</span></span>
<span><span class="co">## 3     64.4,64.8,65.2     134.4         1</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Only missing core spectra variables</span></span>
<span><span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">be</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"collisionEnergy"</span>, <span class="st">"mzMin"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## DataFrame with 3 rows and 2 columns</span></span>
<span><span class="co">##   collisionEnergy     mzMin</span></span>
<span><span class="co">##         &lt;numeric&gt; &lt;numeric&gt;</span></span>
<span><span class="co">## 1              NA        NA</span></span>
<span><span class="co">## 2              NA        NA</span></span>
<span><span class="co">## 3              NA        NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="peaksdata">
<code>peaksData()</code><a class="anchor" aria-label="anchor" href="#peaksdata"></a>
</h4>
<p>The <code><a href="https://rdrr.io/pkg/ProtGenerics/man/peaksData.html" class="external-link">peaksData()</a></code> method extracts the chromatographic data
(<em>peaks</em>), i.e., the chromatograms’ retention time and intensity
values. This data is returned as a <code>list</code> of arrays, with one
array per chromatogram with columns being the <em>peaks variables</em>
(retention time and intensity values) and rows the individual data
pairs. Each backend must provide retention times and intensity values
with this method, but additional peaks variables (columns) are also
supported.</p>
<p>Below we implement the <code><a href="https://rdrr.io/pkg/ProtGenerics/man/peaksData.html" class="external-link">peaksData()</a></code> method for our
backend. Due to the way we stored the retention time and intensity
values within our object we need to loop over the respective lists (in
<code>@rtime</code> and <code>intensity</code>) and combine the values
of each chromatogram to an array (<code>matrix</code>). Since our
backend does not allow any additional other peaks variables we allow
<code>columns</code> to be only <code>c("rtime", "intensity")</code>,
and also only in that specific order.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' method to extract the full chromatographic data as list of arrays</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span></span>
<span>    <span class="st">"peaksData"</span>, <span class="st">"ChromBackendTest"</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">columns</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rtime"</span>, <span class="st">"intensity"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">columns</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">2</span> <span class="op">&amp;&amp;</span> <span class="va">columns</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rtime"</span>, <span class="st">"intensity"</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"'columns' supports only \"rtime\" and \"intensity\""</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span>rtime <span class="op">=</span> <span class="va">object</span><span class="op">@</span><span class="va">rtime</span>, intensity <span class="op">=</span> <span class="va">object</span><span class="op">@</span><span class="va">intensity</span>,</span>
<span>               FUN <span class="op">=</span> <span class="va">cbind</span>, SIMPLIFY <span class="op">=</span> <span class="cn">FALSE</span>, USE.NAMES <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>And with this method we can now extract the peaks data from our
backend.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Extract the *peaks* data (i.e. intensity and retention times)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/peaksData.html" class="external-link">peaksData</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">##      rtime intensity</span></span>
<span><span class="co">## [1,]  12.4     123.3</span></span>
<span><span class="co">## [2,]  12.8     153.6</span></span>
<span><span class="co">## [3,]  13.2    2354.3</span></span>
<span><span class="co">## [4,]  14.6     243.4</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">##      rtime intensity</span></span>
<span><span class="co">## [1,]  45.1     100.0</span></span>
<span><span class="co">## [2,]  46.2      80.1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span>
<span><span class="co">##      rtime intensity</span></span>
<span><span class="co">## [1,]  64.4      12.3</span></span>
<span><span class="co">## [2,]  64.8     135.2</span></span>
<span><span class="co">## [3,]  65.2     100.0</span></span></code></pre>
<p>Since the <code><a href="https://rdrr.io/pkg/ProtGenerics/man/peaksData.html" class="external-link">peaksData()</a></code> method is the main function used
by a <code>Chromatograms</code> to retrieve data from the backend (and
further process the values), this method should be implemented in an
efficient way. Due to the way we store the data within our example
backend we need to loop over the <code>@rtime</code> and
<code>@intensity</code> slots. A different implementation that stores
the peaks data already as a <code>list</code> of arrays would be more
efficient for this operation (but eventually slower for some other
operations, such as extracting peaks variables separately with the
<code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">rtime()</a></code> or <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">intensity()</a></code> functions.</p>
</div>
<div class="section level4">
<h4 id="section">
<code>[</code><a class="anchor" aria-label="anchor" href="#section"></a>
</h4>
<p>The <code>[</code> method allows to subset <code>ChromBackend</code>
objects. This operation is expected to reduce a
<code>ChromBackend</code> object to the selected chromatograms without
changing values for the subset chromatograms. The method should support
to subset by indices or logical vectors and should also support
duplicating elements (i.e., when duplicated indices are used) as well as
to subset in arbitrary order. An error should be thrown if indices are
out of bounds, but the method should also support returning an empty
backend with <code>[integer()]</code>. The
<code><a href="https://rdrr.io/pkg/MsCoreUtils/man/i2index.html" class="external-link">MsCoreUtils::i2index</a></code> function can be used to check and
convert the provided parameter <code>i</code> (defining the subset) to
an integer vector.</p>
<p>Below we implement a possible <code>[</code> for our test backend
class. We ignore the parameters <code>j</code> from the definition of
the <code>[</code> generic, since we treat our data to be
one-dimensional (with each chromatogram being one element).</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Main subset method.</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"["</span>, <span class="st">"ChromBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">i</span>, <span class="va">j</span>, <span class="va">...</span>, <span class="va">drop</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">i</span> <span class="op">&lt;-</span> <span class="fu">MsCoreUtils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MsCoreUtils/man/i2index.html" class="external-link">i2index</a></span><span class="op">(</span><span class="va">i</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">x</span><span class="op">@</span><span class="va">chromVars</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">@</span><span class="va">chromVars</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span></span>
<span>    <span class="va">x</span><span class="op">@</span><span class="va">rtime</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">@</span><span class="va">rtime</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="va">x</span><span class="op">@</span><span class="va">intensity</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">@</span><span class="va">intensity</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="va">x</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>We can now subset our backend to the last two chromatograms.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">be</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## DataFrame with 2 rows and 16 columns</span></span>
<span><span class="co">##   chromIndex collisionEnergy      dataOrigin dataStorage         intensity</span></span>
<span><span class="co">##    &lt;integer&gt;       &lt;numeric&gt;     &lt;character&gt; &lt;character&gt;     &lt;NumericList&gt;</span></span>
<span><span class="co">## 1         NA              NA &lt;user provided&gt;    &lt;memory&gt;       100.0, 80.1</span></span>
<span><span class="co">## 2         NA              NA &lt;user provided&gt;    &lt;memory&gt;  12.3,135.2,100.0</span></span>
<span><span class="co">##     msLevel        mz     mzMin     mzMax precursorMz precursorMzMin</span></span>
<span><span class="co">##   &lt;integer&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;      &lt;numeric&gt;</span></span>
<span><span class="co">## 1         1     123.3        NA        NA          NA             NA</span></span>
<span><span class="co">## 2         1     134.4        NA        NA          NA             NA</span></span>
<span><span class="co">##   precursorMzMax productMz productMzMin productMzMax          rtime</span></span>
<span><span class="co">##        &lt;numeric&gt; &lt;numeric&gt;    &lt;numeric&gt;    &lt;numeric&gt;  &lt;NumericList&gt;</span></span>
<span><span class="co">## 1             NA        NA           NA           NA      45.1,46.2</span></span>
<span><span class="co">## 2             NA        NA           NA           NA 64.4,64.8,65.2</span></span></code></pre>
<p>Or extracting the second chromatogram multiple times.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">be</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## DataFrame with 3 rows and 16 columns</span></span>
<span><span class="co">##     chromIndex collisionEnergy      dataOrigin dataStorage     intensity</span></span>
<span><span class="co">##      &lt;integer&gt;       &lt;numeric&gt;     &lt;character&gt; &lt;character&gt; &lt;NumericList&gt;</span></span>
<span><span class="co">## 2           NA              NA &lt;user provided&gt;    &lt;memory&gt;   100.0, 80.1</span></span>
<span><span class="co">## 2.1         NA              NA &lt;user provided&gt;    &lt;memory&gt;   100.0, 80.1</span></span>
<span><span class="co">## 2.2         NA              NA &lt;user provided&gt;    &lt;memory&gt;   100.0, 80.1</span></span>
<span><span class="co">##       msLevel        mz     mzMin     mzMax precursorMz precursorMzMin</span></span>
<span><span class="co">##     &lt;integer&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;      &lt;numeric&gt;</span></span>
<span><span class="co">## 2           1     123.3        NA        NA          NA             NA</span></span>
<span><span class="co">## 2.1         1     123.3        NA        NA          NA             NA</span></span>
<span><span class="co">## 2.2         1     123.3        NA        NA          NA             NA</span></span>
<span><span class="co">##     precursorMzMax productMz productMzMin productMzMax         rtime</span></span>
<span><span class="co">##          &lt;numeric&gt; &lt;numeric&gt;    &lt;numeric&gt;    &lt;numeric&gt; &lt;NumericList&gt;</span></span>
<span><span class="co">## 2               NA        NA           NA           NA     45.1,46.2</span></span>
<span><span class="co">## 2.1             NA        NA           NA           NA     45.1,46.2</span></span>
<span><span class="co">## 2.2             NA        NA           NA           NA     45.1,46.2</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="section-1">
<code>$</code><a class="anchor" aria-label="anchor" href="#section-1"></a>
</h4>
<p>The <code>$</code> method is expected to extract a single
chromatogram variable from a backend. Parameter <code>name</code> should
allow to name the chromatogram variable to return. Each
<code>ChromBackend</code> <strong>must</strong> support extracting the
core chromatogram variables with this method (even if no data might be
available for that variable). In our example implementation below we
make use of the <code><a href="../reference/ChromBackend.html">chromData()</a></code> method, but more efficient
implementations might be possible as well (that would not require to
first subset/create a <code>DataFrame</code> with the full data and to
then subset that again to an individual column). Also, the
<code>$</code> method should check if the requested spectra variable is
available and should throw an error otherwise.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Access a single chromatogram variable</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"$"</span>, <span class="st">"ChromBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">name</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">x</span>, columns <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>With this we can now extract the MS levels</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">be</span><span class="op">$</span><span class="va">msLevel</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1 1 1</span></span></code></pre>
<p>or a core spectra variable without values in our example backend.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">be</span><span class="op">$</span><span class="va">precursorMz</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] NA NA NA</span></span></code></pre>
<p>or also the intensity values</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">be</span><span class="op">$</span><span class="va">intensity</span></span></code></pre></div>
<pre><code><span><span class="co">## NumericList of length 3</span></span>
<span><span class="co">## [[1]] 123.3 153.6 2354.3 243.4</span></span>
<span><span class="co">## [[2]] 100 80.1</span></span>
<span><span class="co">## [[3]] 12.3 135.2 100</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="backendmerge">
<code>backendMerge()</code><a class="anchor" aria-label="anchor" href="#backendmerge"></a>
</h4>
<p>The <code><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">backendMerge()</a></code> method merges (combines)
<code>ChromBackend</code> objects (of the same type!) into a single
instance. For our test backend we thus need to combine the values in the
<code>@chromVars</code>, <code>@rtime</code> and <code>@intensity</code>
slots. To support also merging of <code>data.frame</code>s with
different sets of columns we use the <code><a href="https://rdrr.io/pkg/MsCoreUtils/man/rbindFill.html" class="external-link">MsCoreUtils::rbindFill</a></code>
function instead of a simple <code>rbind</code> (this function joins
data frames making an union of all available columns filling eventually
missing columns with <code>NA</code>).</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Method allowing to join (concatenate) backends</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"backendMerge"</span>, <span class="st">"ChromBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">res</span> <span class="op">&lt;-</span> <span class="va">object</span></span>
<span>    <span class="va">object</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">res</span><span class="op">@</span><span class="va">rtime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">c</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">object</span>, <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="va">z</span><span class="op">@</span><span class="va">rtime</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">res</span><span class="op">@</span><span class="va">intensity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">c</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">object</span>, <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="va">z</span><span class="op">@</span><span class="va">intensity</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">res</span><span class="op">@</span><span class="va">chromVars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="fu">MsCoreUtils</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/MsCoreUtils/man/rbindFill.html" class="external-link">rbindFill</a></span>,</span>
<span>                             <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">object</span>, <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="va">z</span><span class="op">@</span><span class="va">chromVars</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu">validObject</span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span>    <span class="va">res</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Testing the function by merging the example backend instance with
itself.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">backendMerge</a></span><span class="op">(</span><span class="va">be</span>, <span class="va">be</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">be</span><span class="op">)</span></span>
<span><span class="va">a</span></span></code></pre></div>
<pre><code><span><span class="co">## ChromBackendTest with 7 chromatograms</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="data-replacement-methods">Data replacement methods<a class="anchor" aria-label="anchor" href="#data-replacement-methods"></a>
</h3>
<p>As stated in the general description, <code>ChromBackend</code>
implementations can also be purely <em>read-only</em> resources allowing
to just access, but not to replace data. For these backends
<code><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">isReadOnly()</a></code> should return <code>FALSE</code>. Data
replacement methods listed in this section would not need to be
implemented. Our example backend stores the full data in memory, within
the object, and hence we can easily change and replace values.</p>
<p>Since we support replacing values we also implement the
<code><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">isReadOnly()</a></code> method for our example implementation to
return <code>FALSE</code> (instead of the default
<code>TRUE</code>).</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default for backends:</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">isReadOnly</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Implementation of isReadOnly for ChromBackendTest</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"isReadOnly"</span>, <span class="st">"ChromBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">isReadOnly</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] FALSE</span></span></code></pre>
<p>All data replacement function are expected to return an instance of
the same backend class that was used as input.</p>
<div class="section level4">
<h4 id="chromdata-">
<code>chromData&lt;-</code><a class="anchor" aria-label="anchor" href="#chromdata-"></a>
</h4>
<p>The main replacement method is <code>chromData&lt;-</code> which
should allow to replace the content of a backend with new data. This
data is expected to be provided as a <code>DataFrame</code> (similar to
the one returned by <code><a href="../reference/ChromBackend.html">chromData()</a></code>). Also the method is
expected to replace the <strong>full</strong> data within the backend,
i.e., all chromatogram and peaks variables. While values can be
replaced, the number of chromatograms before and after a call to
<code>chromData&lt;-</code> has to be the same. For our example
implementation of <code>chromData&lt;-</code> we can re-use the
<code><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">backendInitialize()</a></code> method defined before, with the
<code>data</code> parameter.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Replacement method for the full chromatogram data</span></span>
<span><span class="fu">setReplaceMethod</span><span class="op">(</span><span class="st">"chromData"</span>, <span class="st">"ChromBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">value</span>, <span class="st">"DataFrame"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"'value' is expected to be a 'DataFrame'"</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"'value' has to be a 'DataFrame' with "</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>, <span class="st">" rows"</span><span class="op">)</span></span>
<span>    <span class="va">object</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">backendInitialize</a></span><span class="op">(</span><span class="fu">ChromBackendTest</span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">value</span><span class="op">)</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>To test this new method we extract the full chromatogram data from
our example data set, add an additional column (chromatogram variable)
and use <code>chromData&lt;-</code> to replace the data of the
backend.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">new_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">d</span></span></code></pre></div>
<p>Check that we have now also the new column available.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">be</span><span class="op">$</span><span class="va">new_col</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "a" "b" "c"</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="section-2">
<code>$&lt;-</code><a class="anchor" aria-label="anchor" href="#section-2"></a>
</h4>
<p>The <code>$&lt;-</code> method should allow to replace values for an
existing chromatogram variable or to add an additional variable to the
backend. As with all replacement methods, the <code>length</code> of
<code>value</code> has to match the number of chromatograms represented
by the backend. For replacement of retention time or intensity values we
need also to ensure that the data would be correct after the operation,
i.e., that the number of retention time and intensity values per
chromatogram are the identical and that all retention time and intensity
values are numeric. Finally, we use the <code><a href="../reference/validChromData.html">validChromData()</a></code>
function to ensure that, after replacement, all core chromatogram
variables have the correct data type.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Replace or add a single chromatogram variable.</span></span>
<span><span class="fu">setReplaceMethod</span><span class="op">(</span><span class="st">"$"</span>, <span class="st">"ChromBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">name</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"length of 'value' needs to match the number of chromatograms "</span>,</span>
<span>             <span class="st">"in object."</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rtime"</span>, <span class="st">"intensity"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co">## In case retention time or intensity values are provided as</span></span>
<span>        <span class="co">## NumericList convert to a list.</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu">is</span><span class="op">(</span><span class="va">value</span>, <span class="st">"NumericList"</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="va">value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span></span>
<span>        <span class="co">## Ensure number of retention time and intensity values match</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">x</span><span class="op">@</span><span class="va">intensity</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Number of retention time values needs to match number of "</span>,</span>
<span>                 <span class="st">"intensity values."</span><span class="op">)</span></span>
<span>        <span class="co">## Ensure all values are numeric</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">value</span>, <span class="va">is.numeric</span>, <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"For replacement of retention time or intensity values, "</span>,</span>
<span>                 <span class="st">"'value' is expected to be a list of numeric vectors."</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"rtime"</span><span class="op">)</span></span>
<span>            <span class="va">x</span><span class="op">@</span><span class="va">rtime</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"intensity"</span><span class="op">)</span></span>
<span>            <span class="va">x</span><span class="op">@</span><span class="va">intensity</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span></span>
<span>        <span class="va">x</span><span class="op">@</span><span class="va">chromVars</span><span class="op">[[</span><span class="va">name</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="co">## Check that data types are correct after replacement</span></span>
<span>    <span class="fu"><a href="../reference/validChromData.html">validChromData</a></span><span class="op">(</span><span class="va">x</span><span class="op">@</span><span class="va">chromVars</span><span class="op">)</span></span>
<span>    <span class="va">x</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>We can thus replace an existing chromatogram variable, such as
<code>msLevel</code>:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Values before replacement</span></span>
<span><span class="va">be</span><span class="op">$</span><span class="va">msLevel</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1 1 1</span></span></code></pre>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Replace MS levels</span></span>
<span><span class="va">be</span><span class="op">$</span><span class="va">msLevel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3L</span>, <span class="fl">2L</span>, <span class="fl">1L</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' Values after replacement</span></span>
<span><span class="va">be</span><span class="op">$</span><span class="va">msLevel</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 3 2 1</span></span></code></pre>
<p>We can also add a new chromatogram variables:</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Add a new chromatogram variable</span></span>
<span><span class="va">be</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span><span class="op">)</span></span>
<span><span class="va">be</span><span class="op">$</span><span class="va">name</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "A" "B" "C"</span></span></code></pre>
<p>Or also replace intensity values. Below we replace the intensity
values by adding a value of +3 to each.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Replace intensity values</span></span>
<span><span class="va">be</span><span class="op">$</span><span class="va">intensity</span> <span class="op">&lt;-</span> <span class="va">be</span><span class="op">$</span><span class="va">intensity</span> <span class="op">+</span> <span class="fl">3</span></span>
<span><span class="va">be</span><span class="op">$</span><span class="va">intensity</span></span></code></pre></div>
<pre><code><span><span class="co">## NumericList of length 3</span></span>
<span><span class="co">## [[1]] 126.3 156.6 2357.3 246.4</span></span>
<span><span class="co">## [[2]] 103 83.1</span></span>
<span><span class="co">## [[3]] 15.3 138.2 103</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="selectchromvariables">
<code>selectChromVariables()</code><a class="anchor" aria-label="anchor" href="#selectchromvariables"></a>
</h4>
<p>The <code><a href="../reference/ChromBackend.html">selectChromVariables()</a></code> function should subset the
content of a backend to the selected chromatogram variables, that can be
specified with parameter <code>chromVariables</code>. As a result the
input backend should be returned, but reduced to the selected
chromatogram variables. This function thus adds a subset operation that
reduces the data in a backend by <em>columns</em>, dropping all
chromatogram variables other than the ones specified with the
<code>chromVariables</code> parameter. In the implementation we need to
give special care to variables <code>"rtime"</code> and
<code>"intensity"</code>. If both are about to be removed we need to
initialize the <code>@rtime</code> and <code>@intensity</code> slots
with empty lists matching the number of chromatograms in our backend. If
only <code>"intensity"</code> values are to be removed we replace them
with <code>NA_real_</code> while removing only <code>"rtime"</code> is
not supported (also because retention time values of <code>NA</code> are
not allowed).</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Method to *subset* a backend by chromatogram variables (columns)</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span></span>
<span>    <span class="st">"selectChromVariables"</span>, <span class="st">"ChromBackendTest"</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">chromVariables</span> <span class="op">=</span> <span class="fu"><a href="../reference/ChromBackend.html">chromVariables</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">object</span><span class="op">@</span><span class="va">chromVars</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">chromVariables</span></span>
<span>        <span class="va">object</span><span class="op">@</span><span class="va">chromVars</span> <span class="op">&lt;-</span> <span class="va">object</span><span class="op">@</span><span class="va">chromVars</span><span class="op">[</span>, <span class="va">keep</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>        <span class="co">## If neither "rtime" and "intensity" is in chromVariables: initialize</span></span>
<span>        <span class="co">## with empty vectors.</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rtime"</span>, <span class="st">"intensity"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">chromVariables</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">object</span><span class="op">@</span><span class="va">rtime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="va">object</span><span class="op">@</span><span class="va">intensity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>            <span class="co">## intensity not in chromVariables: replace intensity values with NA</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="st">"intensity"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">chromVariables</span><span class="op">)</span></span>
<span>                <span class="va">object</span><span class="op">@</span><span class="va">intensity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">object</span><span class="op">@</span><span class="va">intensity</span>,</span>
<span>                                           <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA_real_</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="co">## removal of only rtime is not supported</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="st">"rtime"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">chromVariables</span><span class="op">)</span></span>
<span>                <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Exclusive removal of retention times is not supported. "</span>,</span>
<span>                     <span class="st">"Retention times can only be removed if also intensity "</span>,</span>
<span>                     <span class="st">"values are removed."</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="fu">validObject</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span>        <span class="va">object</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>We can now restrict the data set to only selected chrom
variables:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' keep only dataStorage and msLevel</span></span>
<span><span class="va">be_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ChromBackend.html">selectChromVariables</a></span><span class="op">(</span><span class="va">be</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dataStorage"</span>, <span class="st">"msLevel"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">be_2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## DataFrame with 3 rows and 16 columns</span></span>
<span><span class="co">##   chromIndex collisionEnergy  dataOrigin dataStorage     intensity   msLevel</span></span>
<span><span class="co">##    &lt;integer&gt;       &lt;numeric&gt; &lt;character&gt; &lt;character&gt; &lt;NumericList&gt; &lt;integer&gt;</span></span>
<span><span class="co">## 1         NA              NA          NA    &lt;memory&gt;                       3</span></span>
<span><span class="co">## 2         NA              NA          NA    &lt;memory&gt;                       2</span></span>
<span><span class="co">## 3         NA              NA          NA    &lt;memory&gt;                       1</span></span>
<span><span class="co">##          mz     mzMin     mzMax precursorMz precursorMzMin precursorMzMax</span></span>
<span><span class="co">##   &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;      &lt;numeric&gt;      &lt;numeric&gt;</span></span>
<span><span class="co">## 1        NA        NA        NA          NA             NA             NA</span></span>
<span><span class="co">## 2        NA        NA        NA          NA             NA             NA</span></span>
<span><span class="co">## 3        NA        NA        NA          NA             NA             NA</span></span>
<span><span class="co">##   productMz productMzMin productMzMax         rtime</span></span>
<span><span class="co">##   &lt;numeric&gt;    &lt;numeric&gt;    &lt;numeric&gt; &lt;NumericList&gt;</span></span>
<span><span class="co">## 1        NA           NA           NA              </span></span>
<span><span class="co">## 2        NA           NA           NA              </span></span>
<span><span class="co">## 3        NA           NA           NA</span></span></code></pre>
<p>Replacing/removing intensity values would be possible:</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Keep dataStorage, msLevel, mz and rtime</span></span>
<span><span class="va">be_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ChromBackend.html">selectChromVariables</a></span><span class="op">(</span><span class="va">be</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dataStorage"</span>, <span class="st">"msLevel"</span>, <span class="st">"mz"</span>, <span class="st">"rtime"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">be_2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## DataFrame with 3 rows and 16 columns</span></span>
<span><span class="co">##   chromIndex collisionEnergy  dataOrigin dataStorage     intensity   msLevel</span></span>
<span><span class="co">##    &lt;integer&gt;       &lt;numeric&gt; &lt;character&gt; &lt;character&gt; &lt;NumericList&gt; &lt;integer&gt;</span></span>
<span><span class="co">## 1         NA              NA          NA    &lt;memory&gt;  NA,NA,NA,...         3</span></span>
<span><span class="co">## 2         NA              NA          NA    &lt;memory&gt;         NA,NA         2</span></span>
<span><span class="co">## 3         NA              NA          NA    &lt;memory&gt;      NA,NA,NA         1</span></span>
<span><span class="co">##          mz     mzMin     mzMax precursorMz precursorMzMin precursorMzMax</span></span>
<span><span class="co">##   &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;   &lt;numeric&gt;      &lt;numeric&gt;      &lt;numeric&gt;</span></span>
<span><span class="co">## 1     112.2        NA        NA          NA             NA             NA</span></span>
<span><span class="co">## 2     123.3        NA        NA          NA             NA             NA</span></span>
<span><span class="co">## 3     134.4        NA        NA          NA             NA             NA</span></span>
<span><span class="co">##   productMz productMzMin productMzMax              rtime</span></span>
<span><span class="co">##   &lt;numeric&gt;    &lt;numeric&gt;    &lt;numeric&gt;      &lt;NumericList&gt;</span></span>
<span><span class="co">## 1        NA           NA           NA 12.4,12.8,13.2,...</span></span>
<span><span class="co">## 2        NA           NA           NA          45.1,46.2</span></span>
<span><span class="co">## 3        NA           NA           NA     64.4,64.8,65.2</span></span></code></pre>
<p>All intensity values are thus NA. Removing only intensity values
would (should) throw an error.</p>
</div>
<div class="section level4">
<h4 id="peaksdata-">
<code>peaksData&lt;-</code><a class="anchor" aria-label="anchor" href="#peaksdata-"></a>
</h4>
<p>The <code>peaksData&lt;-</code> method should allow to replace the
full peaks data (retention time and intensity value pairs) of all
chromatograms in a backend. As <code>value</code> a <code>list</code> of
arrays (e.g. two column <code>numeric</code> matrices) should be
provided with columns names <code>"rtime"</code> and
<code>"intensity"</code>. Because the full peaks data is provided at
once, this method can (and should) support changing also the number of
peaks per chromatogram (while the methods like <code>rtime&lt;-</code>
or <code>$rtime</code> would not allow). In our implementation we need
to ensure that a) the provided <code>list</code> is of length equal to
the number of chromatograms and b) each element is a
<code>numeric</code> matrix with <code>"rtime"</code> and
<code>"intensity"</code> columns from which we can extract the
values.</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' replacement method for peaks data</span></span>
<span><span class="fu">setReplaceMethod</span><span class="op">(</span><span class="st">"peaksData"</span>, <span class="st">"ChromBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">value</span>, <span class="st">"SimpleList"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"'value' has to be a list-like object"</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"The length of the provided list has to match the number of "</span>,</span>
<span>             <span class="st">"chromatograms in 'object'"</span><span class="op">)</span></span>
<span>    <span class="co">## First loop to check also for validity of the matrices, i.e. each element</span></span>
<span>    <span class="co">## has to be a `numeric` `matrix` with columns named "rtime" and "intensity"</span></span>
<span>    <span class="va">object</span><span class="op">@</span><span class="va">rtime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">value</span>, <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">is.matrix</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">||</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"'value' is expected to be a 'list' of numeric matrices"</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rtime"</span>, <span class="st">"intensity"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"All matrices in 'value' need to have columns named "</span>,</span>
<span>                 <span class="st">"\"rtime\" and \"intensity\""</span><span class="op">)</span></span>
<span>        <span class="va">z</span><span class="op">[</span>, <span class="st">"rtime"</span><span class="op">]</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="va">object</span><span class="op">@</span><span class="va">intensity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">value</span>, <span class="st">"["</span>, , <span class="st">"intensity"</span><span class="op">)</span></span>
<span>    <span class="fu">validObject</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>With this method we can now replace the peaks data of a backend:</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Create a list with peaks matrices; our backend has 3 chromatograms</span></span>
<span><span class="co">#' thus our `list` has to be of length 3</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>rtime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12.3</span>, <span class="fl">14.4</span>, <span class="fl">15.4</span>, <span class="fl">16.4</span><span class="op">)</span>,</span>
<span>          intensity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">312</span>, <span class="fl">354.1</span>, <span class="fl">232</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>rtime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">14.4</span><span class="op">)</span>,</span>
<span>          intensity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13.4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>rtime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">223.2</span>, <span class="fl">223.8</span>, <span class="fl">234.1</span>, <span class="fl">234.5</span>, <span class="fl">234.9</span><span class="op">)</span>,</span>
<span>          intensity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12.3</span>, <span class="fl">45.3</span>, <span class="fl">65.3</span>, <span class="fl">51.1</span>, <span class="fl">29.3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#' Assign this peaks data to one of our test backends</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/peaksData.html" class="external-link">peaksData</a></span><span class="op">(</span><span class="va">be_2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">tmp</span></span>
<span></span>
<span><span class="co">#' Evaluate that we properly added the peaks data</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/peaksData.html" class="external-link">peaksData</a></span><span class="op">(</span><span class="va">be_2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">##      rtime intensity</span></span>
<span><span class="co">## [1,]  12.3     200.0</span></span>
<span><span class="co">## [2,]  14.4     312.0</span></span>
<span><span class="co">## [3,]  15.4     354.1</span></span>
<span><span class="co">## [4,]  16.4     232.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">##       rtime intensity</span></span>
<span><span class="co">## rtime  14.4      13.4</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span>
<span><span class="co">##      rtime intensity</span></span>
<span><span class="co">## [1,] 223.2      12.3</span></span>
<span><span class="co">## [2,] 223.8      45.3</span></span>
<span><span class="co">## [3,] 234.1      65.3</span></span>
<span><span class="co">## [4,] 234.5      51.1</span></span>
<span><span class="co">## [5,] 234.9      29.3</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="methods-with-available-default-implementations">Methods with available default implementations<a class="anchor" aria-label="anchor" href="#methods-with-available-default-implementations"></a>
</h3>
<p>Default implementations for the <code>ChromBackend</code> class are
available for a large number of methods. Thus, any backend extending
this class will automatically inherit these default implementations.
Alternative, class-specific, versions can, but don’t need to be
developed. The default versions are defined in the
<em>R/ChromBackend.R</em> file, and also listed in this section. If
alternative versions are implemented it should be ensured that the
expected data type is always used for core chromatogram variables. Use
<code><a href="../reference/ChromBackend.html">coreChromVariables()</a></code> to list these mandatory data
types.</p>
<div class="section level4">
<h4 id="backendparallelfactor">
<code>backendParallelFactor()</code><a class="anchor" aria-label="anchor" href="#backendparallelfactor"></a>
</h4>
<p>The <code><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">backendParallelFactor()</a></code> function allows a backend to
suggest a preferred way it could be split for parallel processing. The
default implementation returns <code><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor()</a></code> (i.e. a
<code>factor</code> of length 0) hence not suggesting any specific
splitting setup.</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Is there a specific way how the object could be best split for</span></span>
<span><span class="co">#' parallel processing?</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"backendParallelFactor"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">backendParallelFactor</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## factor()</span></span>
<span><span class="co">## Levels:</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="chromvariables-1">
<code>chromVariables()</code><a class="anchor" aria-label="anchor" href="#chromvariables-1"></a>
</h4>
<p>The <code><a href="../reference/ChromBackend.html">chromVariables()</a></code> function is expected to return the
names of all available chromatogram variables (which should include the
<em>core</em> chromatogram variables). The default implementation
is:</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' get the available chromatogram variables.</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"chromVariables"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>The result from calling the default implementation on our test
backend:</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ChromBackend.html">chromVariables</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "chromIndex"      "collisionEnergy" "dataOrigin"      "dataStorage"    </span></span>
<span><span class="co">##  [5] "intensity"       "msLevel"         "mz"              "mzMin"          </span></span>
<span><span class="co">##  [9] "mzMax"           "precursorMz"     "precursorMzMin"  "precursorMzMax" </span></span>
<span><span class="co">## [13] "productMz"       "productMzMin"    "productMzMax"    "rtime"          </span></span>
<span><span class="co">## [17] "new_col"         "name"</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="chromindex">
<code>chromIndex()</code><a class="anchor" aria-label="anchor" href="#chromindex"></a>
</h4>
<p>The <code><a href="../reference/ChromBackend.html">chromIndex()</a></code> function should return the value for
the <code>"chromIndex"</code> chromatogram variable. As a result, an
<code>integer</code> of length equal to the number of chromatograms in
<code>object</code> needs to be returned. The default implementation
is:</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' get the values for the chromIndex chromatogram variable</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"chromIndex"</span>, <span class="st">"ChromBackend"</span>,</span>
<span>          <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">columns</span> <span class="op">=</span> <span class="fu"><a href="../reference/ChromBackend.html">chromVariables</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>              <span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">object</span>, columns <span class="op">=</span> <span class="st">"chromIndex"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span>          <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>The result of calling this method on our test backend:</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ChromBackend.html">chromIndex</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] NA NA NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="collisionenergy">
<code>collisionEnergy()</code><a class="anchor" aria-label="anchor" href="#collisionenergy"></a>
</h4>
<p>The <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">collisionEnergy()</a></code> function should return the value
for the <code>"collisionEnergy"</code> chromatogram variable. As a
result, a <code>numeric</code> of length equal to the number of
chromatograms has to be returned. The default implementation is:</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' get the values for the collisionEnergy chromatogram variable</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"collisionEnergy"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">object</span>, columns <span class="op">=</span> <span class="st">"collisionEnergy"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>The result of calling this method on our test backend:</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">collisionEnergy</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] NA NA NA</span></span></code></pre>
<p>The default replacement method for the <code>collisionEnergy</code>
chromatogram variable is:</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default replacement method for collisionEnergy</span></span>
<span><span class="fu">setReplaceMethod</span><span class="op">(</span></span>
<span>    <span class="st">"collisionEnergy"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">object</span><span class="op">$</span><span class="va">collisionEnergy</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>        <span class="va">object</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>This method thus makes use of the <code>$&lt;-</code> replacement
method we implemented above. To test this function we replace the
collision energy below.</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Replace the collision energy</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">collisionEnergy</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">collisionEnergy</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 20 30 20</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="dataorigin-dataorigin-">
<code>dataOrigin()</code>, <code>dataOrigin&lt;-</code><a class="anchor" aria-label="anchor" href="#dataorigin-dataorigin-"></a>
</h4>
<p>The <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataOrigin()</a></code> and <code>dataOrigin&lt;-</code>
methods return or set the value(s) for the <code>"dataOrigin"</code>
chromatogram variable. The values for this chromatogram variable need to
be of type <code>character</code> (the length equal to the number of
chromatograms). The default implementation for <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataOrigin()</a></code>
is:</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default implementation to access dataOrigin</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"dataOrigin"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">object</span>, columns <span class="op">=</span> <span class="st">"dataOrigin"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Below we use this method to access the values of the
<code>dataOrigin</code> chromatogram variable.</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Access the dataOrigin values</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataOrigin</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "&lt;user provided&gt;" "&lt;user provided&gt;" "&lt;user provided&gt;"</span></span></code></pre>
<p>The default implementation for <code>dataOrigin&lt;-</code> uses,
like all defaults for replacement methods, the <code>$&lt;-</code>
method:</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default implementation of the `dataOrigin&lt;-` replacement method</span></span>
<span><span class="fu">setReplaceMethod</span><span class="op">(</span><span class="st">"dataOrigin"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span><span class="op">$</span><span class="va">dataOrigin</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>For our backend we can change the values of the
<code>dataOrigin</code> variable:</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Replace the backend's dataOrigin values</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataOrigin</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"from somewhere"</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataOrigin</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "from somewhere" "from somewhere" "from somewhere"</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="datastorage-datastorage-">
<code>dataStorage()</code>, <code>dataStorage&lt;-</code><a class="anchor" aria-label="anchor" href="#datastorage-datastorage-"></a>
</h4>
<p>Similarly, the <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataStorage()</a></code> and
<code>dataStorage&lt;-</code> methods should allow to get or set the
data storage chromatogram variable. Values of the
<code>dataStorage</code> chromatogram variable are expected to be of
type <code>character</code> and for each chromatogram in a backend one
value needs to be defined (which can not be <code>NA_character</code>).
The default implementation for <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataStorage()</a></code> uses, like
most access methods, the <code><a href="../reference/ChromBackend.html">chromData()</a></code> function:</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default implementation to access dataStorage</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"dataStorage"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">object</span>, columns <span class="op">=</span> <span class="st">"dataStorage"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Below we use this method to access the values of the
<code>dataStorage</code> chromatogram variable.</p>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Access the dataStorage values</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataStorage</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "&lt;memory&gt;" "&lt;memory&gt;" "&lt;memory&gt;"</span></span></code></pre>
<p>Note that this variable is supposed to provide information on the
location where the data is stored and hence for some type of backends it
might not be possible or advised to let the user change its values. For
such backends a <code>dataStorage&lt;-</code> replacement method should
be implemented specifically that throws an error if values are replaced
with eventually invalid values. The default implementation for this
method uses, like all defaults for replacement methods, the
<code>$&lt;-</code> method:</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default implementation of the `dataStorage&lt;-` replacement method</span></span>
<span><span class="fu">setReplaceMethod</span><span class="op">(</span><span class="st">"dataStorage"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span><span class="op">$</span><span class="va">dataStorage</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>For our backend we can change the values of the
<code>dataStorage</code> variable:</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Replace the backend's datastorage values</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataStorage</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"here"</span>, <span class="st">"here"</span>, <span class="st">"here"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataStorage</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "here" "here" "here"</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="intensity-intensity-">
<code>intensity()</code>, <code>intensity&lt;-</code><a class="anchor" aria-label="anchor" href="#intensity-intensity-"></a>
</h4>
<p>The <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">intensity()</a></code> and <code>intensity&lt;-</code> methods
allow to extract or set the intensity values of the individual
chromatograms represented by the backend. The default for the
<code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">intensity()</a></code> function, which is expected to return a
<code>list</code> of <code>numeric</code> values with the intensity
values of each chromatogram, uses also the <code><a href="../reference/ChromBackend.html">chromData()</a></code>
method:</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default method to extract intensity values</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"intensity"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">object</span>, columns <span class="op">=</span> <span class="st">"intensity"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Based on the way our example backend implementation stores the data,
accessing the intensity values in this way would not be very efficient.
It would be much faster to directly return the content of the
<code>@intensity</code> slot, converting that into the expected
<code>NumericList</code>. Thus we implement below a more efficient
version of the method specifically for our backend:</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Alternative implementation for our backend</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"intensity"</span>, <span class="st">"ChromBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">IRanges</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/AtomicList-class.html" class="external-link">NumericList</a></span><span class="op">(</span><span class="va">object</span><span class="op">@</span><span class="va">intensity</span>, compress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">intensity</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## NumericList of length 3</span></span>
<span><span class="co">## [[1]] 126.3 156.6 2357.3 246.4</span></span>
<span><span class="co">## [[2]] 103 83.1</span></span>
<span><span class="co">## [[3]] 15.3 138.2 103</span></span></code></pre>
<p>The default replacement method for intensity values uses the
<code>$&lt;-</code> method:</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default implementation of the replacement method for intensity values</span></span>
<span><span class="fu">setReplaceMethod</span><span class="op">(</span><span class="st">"intensity"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span><span class="op">$</span><span class="va">intensity</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Also here we could implement an alternative version that replaces
directly the content of the <code>@intensity</code> slot. We implement
such a replacement method further below for the <code>rtime&lt;-</code>
method. Here we simply use the default implementation to replace the
intensity values with original values divided by 10.</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Replace intensity values</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">intensity</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">intensity</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">/</span> <span class="fl">10</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">intensity</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## NumericList of length 3</span></span>
<span><span class="co">## [[1]] 12.63 15.66 235.73 24.64</span></span>
<span><span class="co">## [[2]] 10.3 8.31</span></span>
<span><span class="co">## [[3]] 1.53 13.82 10.3</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="isempty">
<code>isEmpty()</code><a class="anchor" aria-label="anchor" href="#isempty"></a>
</h4>
<p>The <code>isEmpty()</code> is a simple helper function to evaluate
whether chromatograms are <em>empty</em>, i.e. have no peaks (retention
time and intensity values). It should return a logical vector of length
equal to the number of chromatograms in the backend with
<code>TRUE</code> if a chromatogram is empty and <code>FALSE</code>
otherwise. The default implementation uses the <code><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths()</a></code>
method (defined further below) that returns for each chromatogram the
number of available data points (peaks).</p>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default implementation for `isEmpty()`</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"isEmpty"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0L</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">isEmpty</span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] FALSE FALSE FALSE</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="isreadonly">
<code>isReadOnly()</code><a class="anchor" aria-label="anchor" href="#isreadonly"></a>
</h4>
<p>As discussed above, backends can also be <em>read-only</em>, hence
only allowing to access, but not to change any values (e.g. if the data
is stored in a data base and the connection to this data base does not
support updating or replacing data). In such cases, the default
<code><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">isReadOnly()</a></code> method can be used, which returns always
<code>TRUE</code>:</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default implementation of `isReadOnly()`</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"isReadOnly"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="cn">TRUE</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Backends that support changing data values should implement their own
version (like we did above) to return <code>FALSE</code> instead:</p>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/backendInitialize.html" class="external-link">isReadOnly</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] FALSE</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="length-1">
<code>length()</code><a class="anchor" aria-label="anchor" href="#length-1"></a>
</h4>
<p>The <code><a href="https://rdrr.io/r/base/length.html" class="external-link">length()</a></code> method should return a single
<code>integer</code> with the total number of chromatograms available
through the backend. The default implementation for this function
is:</p>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default implementation for `length()`</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"length"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">x</span>, columns <span class="op">=</span> <span class="st">"dataStorage"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 3</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="lengths">
<code>lengths()</code><a class="anchor" aria-label="anchor" href="#lengths"></a>
</h4>
<p>The <code><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths()</a></code> function should return the number of data
pairs (peaks; retention time or intensity values) per chromatogram. The
result should be an <code>integer</code> vector (of length equal to the
number of chromatograms in the backend) with these counts. The default
implementation uses the <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">intensity()</a></code> function.</p>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default implementation for `lengths()`</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"lengths"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">intensity</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>The number of peaks for our test backend:</p>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 4 2 3</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="mslevel-mslevel-">
<code>msLevel()</code>, <code>msLevel&lt;-</code><a class="anchor" aria-label="anchor" href="#mslevel-mslevel-"></a>
</h4>
<p>The <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">msLevel()</a></code> and <code>msLevel&lt;-</code> methods
should allow extracting and setting the MS level for the individual
chromatograms. MS levels are encoded as <code>integer</code>, thus,
<code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">msLevel()</a></code> must return an <code>integer</code> vector of
length equal to the number of chromatograms of the backend and
<code>msLevel&lt;-</code> should take/accept such a vector as input. The
default implementations for both methods are shown below.</p>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default methods to get or set MS levels</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"msLevel"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">object</span>, columns <span class="op">=</span> <span class="st">"msLevel"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu">setReplaceMethod</span><span class="op">(</span><span class="st">"msLevel"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span><span class="op">$</span><span class="va">msLevel</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>To test these we below replace the MS levels for our test data set
and extract these values again.</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">msLevel</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">2L</span>, <span class="fl">4L</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">msLevel</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1 2 4</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="mz-mz-">
<code>mz()</code>, <code>mz&lt;-</code><a class="anchor" aria-label="anchor" href="#mz-mz-"></a>
</h4>
<p>The <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">mz()</a></code> and <code>mz&lt;-</code> methods should allow
to extract or set the m/z value for each chromatogram. The m/z value of
a chromatogram is encoded as <code>numeric</code>, thus, the methods are
expected to return or accept a <code>numeric</code> vector of length
equal to the number of chromatograms. The default implementations are
shown below.</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default implementations to get or set m/z value(s)</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"mz"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">object</span>, columns <span class="op">=</span> <span class="st">"mz"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu">setReplaceMethod</span><span class="op">(</span><span class="st">"mz"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span><span class="op">$</span><span class="va">mz</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>We below set and extract these <em>target</em> m/z values.</p>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">mz</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">314.3</span>, <span class="fl">312.5</span>, <span class="fl">542.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">mz</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 314.3 312.5 542.1</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="mzmax-mzmax-">
<code>mzMax()</code>, <code>mzMax&lt;-</code><a class="anchor" aria-label="anchor" href="#mzmax-mzmax-"></a>
</h4>
<p>The <code><a href="../reference/ChromBackend.html">mzMax()</a></code> and <code>mzMax&lt;-</code> methods should
allow to extract or set the upper m/z boundary for each chromatogram.
m/z values are encoded as <code>numeric</code>, thus, the methods are
expected to return or accept a <code>numeric</code> vector of length
equal to the number of chromatograms. The default implementations are
shown below.</p>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default implementations to get or set upper m/z limits</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"mzMax"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">object</span>, columns <span class="op">=</span> <span class="st">"mzMax"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu">setReplaceMethod</span><span class="op">(</span><span class="st">"mzMax"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span><span class="op">$</span><span class="va">mzMax</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Testing these functions by replacing the upper m/z boundary with new
values.</p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ChromBackend.html">mzMax</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">mz</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.01</span></span>
<span><span class="fu"><a href="../reference/ChromBackend.html">mzMax</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 314.31 312.51 542.11</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="mzminmzmin-">
<code>mzMin(),</code>mzMin&lt;-`<a class="anchor" aria-label="anchor" href="#mzminmzmin-"></a>
</h4>
<p>The <code><a href="../reference/ChromBackend.html">mzMin()</a></code> and <code>mzMin&lt;-</code> methods should
allow to extract or set the lower m/z boundary for each chromatogram.
m/z values are encoded as <code>numeric</code>, thus, the methods are
expected to return or accept a <code>numeric</code> vector of length
equal to the number of chromatograms. The default implementations are
shown below.</p>
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default methods to get or set the lower m/z boundary</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"mzMin"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">object</span>, columns <span class="op">=</span> <span class="st">"mzMin"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu">setReplaceMethod</span><span class="op">(</span><span class="st">"mzMin"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span><span class="op">$</span><span class="va">mzMin</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Testing these functions by replacing the lower m/z boundary with new
values.</p>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ChromBackend.html">mzMin</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">mz</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.01</span></span>
<span><span class="fu"><a href="../reference/ChromBackend.html">mzMin</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 314.29 312.49 542.09</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="peaksvariables">
<code>peaksVariables()</code><a class="anchor" aria-label="anchor" href="#peaksvariables"></a>
</h4>
<p>The <code><a href="https://rdrr.io/pkg/ProtGenerics/man/peaksData.html" class="external-link">peaksVariables()</a></code> function is supposed to provide the
names of the available <em>peaks variables</em>. Backends
<strong>must</strong> provide retention time and intensity values, thus,
the default implementation simply returns
<code>c("rtime", "intensity")</code>. If additional peaks variables
would be available, these could also be listed by the
<code><a href="https://rdrr.io/pkg/ProtGenerics/man/peaksData.html" class="external-link">peaksVariables()</a></code> method.</p>
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default implementation for peaksVariables()</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span></span>
<span>    <span class="st">"peaksVariables"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rtime"</span>, <span class="st">"intensity"</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/peaksData.html" class="external-link">peaksVariables</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "rtime"     "intensity"</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="precursormz-precursormz-">
<code>precursorMz()</code>, <code>precursorMz&lt;-</code><a class="anchor" aria-label="anchor" href="#precursormz-precursormz-"></a>
</h4>
<p>The <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">precursorMz()</a></code> and <code>precursorMz&lt;-</code>
methods are expected to get or set the values for the precursor m/z of
each chromatogram (if available). These are encoded as
<code>numeric</code> (one value per chromatogram) - and if a value is
not available <code>NA_real_</code> should be returned. The default
implementations are:</p>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default implementations to get or set the precursorMz chrom variable</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"precursorMz"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">object</span>, columns <span class="op">=</span> <span class="st">"precursorMz"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu">setReplaceMethod</span><span class="op">(</span><span class="st">"precursorMz"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span><span class="op">$</span><span class="va">precursorMz</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Below we set and get the <code>precursorMz</code> chromatogram
variable for our backend.</p>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">precursorMz</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA_real_</span>, <span class="fl">123.3</span>, <span class="fl">314.2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">precursorMz</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1]    NA 123.3 314.2</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="precursormzmax-precursormzmax-">
<code>precursorMzMax()</code>, <code>precursorMzMax&lt;-</code><a class="anchor" aria-label="anchor" href="#precursormzmax-precursormzmax-"></a>
</h4>
<p>These methods are supposed to allow to get and set the
<code>precursorMzMax</code> chromatogram variable. The default
implementations are:</p>
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default implementations for `precursorMzMax`</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"precursorMzMax"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">object</span>, columns <span class="op">=</span> <span class="st">"precursorMzMax"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu">setReplaceMethod</span><span class="op">(</span><span class="st">"precursorMzMax"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span><span class="op">$</span><span class="va">precursorMzMax</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Below we test these functions by setting and extracting the values
for this chromatogram variable.</p>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ChromBackend.html">precursorMzMax</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">precursorMz</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.1</span></span>
<span><span class="fu"><a href="../reference/ChromBackend.html">precursorMzMax</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1]    NA 123.4 314.3</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="precursormzmin-precursormzmin-">
<code>precursorMzMin()</code>, <code>precursorMzMin&lt;-</code><a class="anchor" aria-label="anchor" href="#precursormzmin-precursormzmin-"></a>
</h4>
<p>These methods are supposed to allow to get and set the
<code>precursorMzMin</code> chromatogram variable. The default
implementations are:</p>
<div class="sourceCode" id="cb143"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default implementations for `precursorMzMin`</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"precursorMzMin"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">object</span>, columns <span class="op">=</span> <span class="st">"precursorMzMin"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu">setReplaceMethod</span><span class="op">(</span><span class="st">"precursorMzMin"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span><span class="op">$</span><span class="va">precursorMzMin</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Below we test these functions by setting and extracting the values
for this chromatogram variable.</p>
<div class="sourceCode" id="cb144"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ChromBackend.html">precursorMzMin</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">precursorMz</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.1</span></span>
<span><span class="fu"><a href="../reference/ChromBackend.html">precursorMzMin</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1]    NA 123.2 314.1</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="productmz-productmz-">
<code>productMz()</code>, <code>productMz&lt;-</code><a class="anchor" aria-label="anchor" href="#productmz-productmz-"></a>
</h4>
<p>These methods are supposed to allow to get and set the
<code>productMz</code> chromatogram variable. The default
implementations are:</p>
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default implementations for `productMz`</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"productMz"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">object</span>, columns <span class="op">=</span> <span class="st">"productMz"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu">setReplaceMethod</span><span class="op">(</span><span class="st">"productMz"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span><span class="op">$</span><span class="va">productMz</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Below we test these functions by setting and extracting the values
for this chromatogram variable.</p>
<div class="sourceCode" id="cb147"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">productMz</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">123.2</span>, <span class="cn">NA_real_</span>, <span class="cn">NA_real_</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">productMz</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 123.2    NA    NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="productmzmax-productmzmax-">
<code>productMzMax()</code>, <code>productMzMax&lt;-</code><a class="anchor" aria-label="anchor" href="#productmzmax-productmzmax-"></a>
</h4>
<p>These methods are supposed to allow to get and set the
<code>productMzMax</code> chromatogram variable. The default
implementations are:</p>
<div class="sourceCode" id="cb149"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default implementations for `productMzMax`</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"productMzMax"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">object</span>, columns <span class="op">=</span> <span class="st">"productMzMax"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu">setReplaceMethod</span><span class="op">(</span><span class="st">"productMzMax"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span><span class="op">$</span><span class="va">productMzMax</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Below we test these functions by setting and extracting the values
for this chromatogram variable.</p>
<div class="sourceCode" id="cb150"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ChromBackend.html">productMzMax</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">productMz</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.02</span></span>
<span><span class="fu"><a href="../reference/ChromBackend.html">productMzMax</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 123.22     NA     NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="productmzmin-productmzmin-">
<code>productMzMin()</code>, <code>productMzMin&lt;-</code><a class="anchor" aria-label="anchor" href="#productmzmin-productmzmin-"></a>
</h4>
<p>These methods are supposed to allow to get and set the
<code>productMzMin</code> chromatogram variable. The default
implementations are:</p>
<div class="sourceCode" id="cb152"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default implementations for `productMzMin`</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"productMzMin"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">object</span>, columns <span class="op">=</span> <span class="st">"productMzMin"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu">setReplaceMethod</span><span class="op">(</span><span class="st">"productMzMin"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span><span class="op">$</span><span class="va">productMzMin</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Below we test these functions by setting and extracting the values
for this chromatogram variable.</p>
<div class="sourceCode" id="cb153"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ChromBackend.html">productMzMin</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">productMz</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.2</span></span>
<span><span class="fu"><a href="../reference/ChromBackend.html">productMzMin</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 123.2    NA    NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="rtime-rtime-">
<code>rtime()</code>, <code>rtime&lt;-</code><a class="anchor" aria-label="anchor" href="#rtime-rtime-"></a>
</h4>
<p>The <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">rtime()</a></code> and <code>rtime&lt;-</code> methods allow to
get and set the retention times of the individual chromatograms of the
backend. Similar to the method for the intensity values described above
they should return or accept a <code>NumericList</code>, each element
being a <code>numeric</code> vector with the retention time values of
one chromatogram. The default implementations of these methods are shown
below.</p>
<div class="sourceCode" id="cb155"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default methods for `rtime()` and `rtime&lt;-`</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"rtime"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/ChromBackend.html">chromData</a></span><span class="op">(</span><span class="va">object</span>, columns <span class="op">=</span> <span class="st">"rtime"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu">setReplaceMethod</span><span class="op">(</span><span class="st">"rtime"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span><span class="op">$</span><span class="va">rtime</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Also these methods use the <code><a href="../reference/ChromBackend.html">chromData()</a></code> function to
extract intensity values and the <code>$&lt;-</code> to replace them.
Due to the way the data is stored in our example backend implementation
this is not the best/most efficient way to get or set these values.
Instead, we could implement the <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">rtime()</a></code> function similar to
<code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">intensity()</a></code> above. For <code>rtime&lt;-</code> we implement
below a version that takes a <code>list</code> or
<code>NumericList</code> as input and directly replaces the values of
the <code>@rtime</code> slot. In this method we need also to ensure that
the provided data is in the correct format, that the number of values
per chromatogram matches the expected values and that no missing values
are provided (<code>NA_real_</code> values are not supported for
retention time).</p>
<div class="sourceCode" id="cb156"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Implementation of `rtime&lt;-` for our backend</span></span>
<span><span class="fu">setReplaceMethod</span><span class="op">(</span><span class="st">"rtime"</span>, <span class="st">"ChromBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co">## Convert to a standard list</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">value</span>, <span class="st">"NumericList"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span></span>
<span>    <span class="co">## Check that length is correct</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Length of 'value' needs to match the number of "</span>,</span>
<span>             <span class="st">"chromatograms in 'object'."</span><span class="op">)</span></span>
<span>    <span class="co">## Check that lengths are correct</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">object</span><span class="op">@</span><span class="va">intensity</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"The number of retention time values per chromatogram need to "</span>,</span>
<span>             <span class="st">"match the numher of intensities for that chromatogram."</span><span class="op">)</span></span>
<span>    <span class="co">## Check that all values are numeric and we don't have missing values</span></span>
<span>    <span class="va">not_ok</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">value</span>, <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">anyNA</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">|</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">not_ok</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"'value' needs to be a list of numeric values without "</span>,</span>
<span>             <span class="st">"missing values"</span><span class="op">)</span></span>
<span>    <span class="va">object</span><span class="op">@</span><span class="va">rtime</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>We below test this implementation replacing the retention times of
our example backend by shifting all values by 2 seconds.</p>
<div class="sourceCode" id="cb157"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">rtime</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">rtime</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">rtime</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## NumericList of length 3</span></span>
<span><span class="co">## [[1]] 14.4 14.8 15.2 16.6</span></span>
<span><span class="co">## [[2]] 47.1 48.2</span></span>
<span><span class="co">## [[3]] 66.4 66.8 67.2</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="split">
<code>split()</code><a class="anchor" aria-label="anchor" href="#split"></a>
</h4>
<p>The <code><a href="https://rdrr.io/r/base/split.html" class="external-link">split()</a></code> method should split the backend into a
<code>list</code> of backends containing subsets of the original
backend. The default implementation uses the default implementation of
<code><a href="https://rdrr.io/r/base/split.html" class="external-link">split()</a></code> from R and should work in most cases. This function
uses the <code>[</code> method to subset/split the object.</p>
<div class="sourceCode" id="cb159"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default method to split a backend</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"split"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">f</span>, <span class="va">drop</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split.default</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">f</span>, drop <span class="op">=</span> <span class="va">drop</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>We below test this by splitting the backend into two subsets.</p>
<div class="sourceCode" id="cb160"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">be</span>, f <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $`1`</span></span>
<span><span class="co">## ChromBackendTest with 2 chromatograms</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`2`</span></span>
<span><span class="co">## ChromBackendTest with 1 chromatograms</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="filter-methods-with-default-implementations">Filter methods with default implementations<a class="anchor" aria-label="anchor" href="#filter-methods-with-default-implementations"></a>
</h3>
<p>A set of filter methods is defined that all allow to subset the
backend to a smaller set of chromatograms, i.e. these filter methods
reduce the number of chromatograms of the backend. Defaults are
available for all methods, but also here alternative versions might be
implemented depending on the backend class.</p>
<div class="section level4">
<h4 id="filterdataorigin">
<code>filterDataOrigin()</code><a class="anchor" aria-label="anchor" href="#filterdataorigin"></a>
</h4>
<p>The <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">filterDataOrigin()</a></code> method allows to filter/subset
the backend keeping only chromatograms for which the
<code>dataOrigin</code> chromatogram variable matches (exactly) the
value(s) provided with parameter <code>dataOrigin</code>.</p>
<div class="sourceCode" id="cb162"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default for `filterDataOrigin()`</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"filterDataOrigin"</span>, <span class="st">"ChromBackend"</span>,</span>
<span>          <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">dataOrigin</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>              <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dataOrigin</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                  <span class="va">object</span> <span class="op">&lt;-</span> <span class="va">object</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataOrigin</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">dataOrigin</span><span class="op">]</span></span>
<span>                  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.unsorted.html" class="external-link">is.unsorted</a></span><span class="op">(</span><span class="va">dataOrigin</span><span class="op">)</span><span class="op">)</span></span>
<span>                      <span class="va">object</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataOrigin</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>, <span class="va">dataOrigin</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>                  <span class="kw">else</span> <span class="va">object</span></span>
<span>              <span class="op">}</span> <span class="kw">else</span> <span class="va">object</span></span>
<span>          <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Like all filter functions, this function is expected to always return
an instance of the backend class, even if no element matches the
provided values:</p>
<div class="sourceCode" id="cb163"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">filterDataOrigin</a></span><span class="op">(</span><span class="va">be</span>, <span class="st">"disk"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ChromBackendTest with 0 chromatograms</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="filterdatastorage">
<code>filterDataStorage()</code><a class="anchor" aria-label="anchor" href="#filterdatastorage"></a>
</h4>
<p>The <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">filterDataStorage()</a></code> method allows to subset a
backend keeping only chromatograms for which values of their
<code>dataStorage</code> chromatogram variable match the value(s)
provided with parameter <code>dataStorage</code>. The default
implementation is shown below.</p>
<div class="sourceCode" id="cb165"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default implementation for `filterDataStorage()`</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"filterDataStorage"</span>, <span class="st">"ChromBackend"</span>,</span>
<span>          <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">dataStorage</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>              <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dataStorage</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                  <span class="va">object</span> <span class="op">&lt;-</span> <span class="va">object</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataStorage</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">dataStorage</span><span class="op">]</span></span>
<span>                  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.unsorted.html" class="external-link">is.unsorted</a></span><span class="op">(</span><span class="va">dataStorage</span><span class="op">)</span><span class="op">)</span></span>
<span>                      <span class="va">object</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataStorage</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>, <span class="va">dataStorage</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>                  <span class="kw">else</span> <span class="va">object</span></span>
<span>              <span class="op">}</span> <span class="kw">else</span> <span class="va">object</span></span>
<span>          <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="filtermslevel">
<code>filterMsLevel()</code><a class="anchor" aria-label="anchor" href="#filtermslevel"></a>
</h4>
<p>The <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">filterMsLevel()</a></code> method allows to subset a backend to
chromatograms with their MS level matching the provided MS levels. The
default implementation is shown below.</p>
<div class="sourceCode" id="cb166"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' The default implementation for `filterMsLevel()`</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"filterMsLevel"</span>, <span class="st">"ChromBackend"</span>,</span>
<span>          <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">msLevel</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>              <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">msLevel</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                  <span class="va">object</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">msLevel</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">msLevel</span><span class="op">]</span></span>
<span>              <span class="op">}</span> <span class="kw">else</span> <span class="va">object</span></span>
<span>          <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="filtermzrange">
<code>filterMzRange()</code><a class="anchor" aria-label="anchor" href="#filtermzrange"></a>
</h4>
<p>The <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">filterMzRange()</a></code> method allows to subset a backend to
chromatograms with their value of the <code>mz</code> chromatogram being
within the provided m/z value range. Parameter <code>mz</code> is
expected to be a <code>numeric</code> of length 2 defining the lower and
upper boundary of the m/z range. The default implementation is shown
below:</p>
<div class="sourceCode" id="cb167"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' The default implementation for `filterMzRange()`</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"filterMzRange"</span>, <span class="st">"ChromBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">mz</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                                    <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mz</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">mz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">mz</span><span class="op">)</span></span>
<span>        <span class="va">keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu">between</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">mz</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>, <span class="va">mz</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">object</span><span class="op">[</span><span class="va">keep</span><span class="op">]</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="filtermzvalues">
<code>filterMzValues()</code><a class="anchor" aria-label="anchor" href="#filtermzvalues"></a>
</h4>
<p>The <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">filterMzValues()</a></code> method allows to subset a backend
to chromatograms with their value of the <code>mz</code> chromatogram
variable being equal to (one) of the provided m/z values, given an
acceptable difference defined by parameters <code>ppm</code> and
<code>tolerance</code>.</p>
<div class="sourceCode" id="cb168"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Default for `filterMzValues()`</span></span>
<span><span class="kw">setMethod</span><span class="op">(</span><span class="st">"filterMzValues"</span>, <span class="st">"ChromBackend"</span>,</span>
<span>          <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">mz</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">ppm</span> <span class="op">=</span> <span class="fl">20</span>, <span class="va">tolerance</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>              <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mz</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                  <span class="va">object</span><span class="op">[</span><span class="fu">.values_match_mz</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">precursorMz</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>, mz <span class="op">=</span> <span class="va">mz</span>,</span>
<span>                                          ppm <span class="op">=</span> <span class="va">ppm</span>, tolerance <span class="op">=</span> <span class="va">tolerance</span><span class="op">)</span><span class="op">]</span></span>
<span>              <span class="op">}</span> <span class="kw">else</span> <span class="va">object</span></span>
<span>          <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<div class="sourceCode" id="cb169"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R Under development (unstable) (2024-03-24 r86185)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.4 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span><span class="co">##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span><span class="co">##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span><span class="co">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span><span class="co">## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] Chromatograms_0.1.0 ProtGenerics_1.35.4 BiocStyle_2.31.0   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] jsonlite_1.8.8      compiler_4.4.0      BiocManager_1.30.22</span></span>
<span><span class="co">##  [4] cluster_2.1.6       jquerylib_0.1.4     systemfonts_1.0.6  </span></span>
<span><span class="co">##  [7] IRanges_2.37.1      textshaping_0.3.7   yaml_2.3.8         </span></span>
<span><span class="co">## [10] fastmap_1.1.1       R6_2.5.1            knitr_1.45         </span></span>
<span><span class="co">## [13] BiocGenerics_0.49.1 htmlwidgets_1.6.4   MASS_7.3-60.2      </span></span>
<span><span class="co">## [16] bookdown_0.38       desc_1.4.3          bslib_0.6.2        </span></span>
<span><span class="co">## [19] rlang_1.1.3         cachem_1.0.8        xfun_0.43          </span></span>
<span><span class="co">## [22] fs_1.6.3            MsCoreUtils_1.15.5  sass_0.4.9         </span></span>
<span><span class="co">## [25] memoise_2.0.1       cli_3.6.2           pkgdown_2.0.7.9000 </span></span>
<span><span class="co">## [28] magrittr_2.0.3      digest_0.6.35       lifecycle_1.0.4    </span></span>
<span><span class="co">## [31] clue_0.3-65         S4Vectors_0.41.5    vctrs_0.6.5        </span></span>
<span><span class="co">## [34] evaluate_0.23       ragg_1.3.0          stats4_4.4.0       </span></span>
<span><span class="co">## [37] rmarkdown_2.26      purrr_1.0.2         tools_4.4.0        </span></span>
<span><span class="co">## [40] htmltools_0.5.8</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Laurent Gatto, Johannes Rainer, Philippine Louail.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
